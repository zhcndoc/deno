---
title: "@std/jsonc"
description: "JSONC 文件的解析和序列化"
jsr: jsr:@std/jsonc
pkg: jsonc
version: 1.0.2
generated: true
stability: stable
---

<!-- Autogenerated from JSR docs. Do not edit directly. -->

## 概述

<p>提供用于处理
<a href="https://code.visualstudio.com/docs/languages/json#_json-with-comments" rel="nofollow">JSONC</a>
（带注释的 JSON）的工具。</p>
<p>目前，该模块仅提供解析 JSONC 的功能。尚不支持 JSONC 序列化。</p>

```js
import { parse } from "@std/jsonc";
import { assertEquals } from "@std/assert";

assertEquals(parse('{"foo": "bar", } // comment'), { foo: "bar" });
assertEquals(parse('{"foo": "bar", } /* comment *\/'), { foo: "bar" });
```

### 添加到你的项目

```sh
deno add jsr:@std/jsonc
```

<a href="https://jsr.io/@std/jsonc/doc" class="docs-cta jsr-cta">查看 @std/jsonc 中的所有符号
<svg class="inline ml-1" viewBox="0 0 13 7" aria-hidden="true" height="20"><path d="M0,2h2v-2h7v1h4v4h-2v2h-7v-1h-4" fill="#083344"></path><g fill="#f7df1e"><path d="M1,3h1v1h1v-3h1v4h-3"></path><path d="M5,1h3v1h-2v1h2v3h-3v-1h2v-1h-2"></path><path d="M9,2h3v2h-1v-1h-1v3h-1"></path></g></svg></a>

<!-- custom:start -->

## 什么是 JSONC？

JSONC（带注释的 JSON）是一种 JSON 的变体，允许添加注释和尾随逗号。它通常用于需要强调人类可读性和维护性的配置文件中，比如 Visual Studio Code 的设置文件。

### 为什么使用 @std/jsonc？

该包允许你轻松解析 JSONC 文件，而标准的 JSON 解析器不支持。它适用于读取可能包含注释或尾随逗号的配置文件，使其更具用户友好性。

## 示例

解析带注释和尾随逗号的内容

```ts
import { parse } from "@std/jsonc";

const text = `{
  // 服务配置
  "host": "localhost",
  "port": 8000, // 允许尾随逗号
}`;

const cfg = parse(text);
// => { host: "localhost", port: 8000 }
```

将用户配置合并到默认配置上

```ts
import { parse } from "@std/jsonc";

const defaults = { host: "127.0.0.1", port: 3000 } as const;
const userText = `{
  // 只覆盖端口
  "port": 8080,
}`;

const user = parse(userText) as Partial<typeof defaults>;
const finalCfg = { ...defaults, ...user };
// => { host: "127.0.0.1", port: 8080 }
```

在 Deno 中加载 .jsonc 文件

```ts
import { parse } from "@std/jsonc";

const raw = await Deno.readTextFile("config.jsonc");
let cfg: unknown;
try {
  cfg = parse(raw);
} catch (err) {
  // 抛出清晰的错误；JSONC 解析器会提示语法位置附近
  throw new Error(`解析 config.jsonc 失败：${err.message}`);
}
```

剥离注释以生成纯 JSON（如果必须输出 JSON）

```ts
// 目前还没有 JSONC 的 stringify。要输出 JSON，先去除注释，然后用 JSON.stringify
function stripJsonc(input: string): string {
  // 移除 /* */ 和 // 注释（简单处理）。注意关键情况要避免删除字符串内部内容。
  return input
    .replace(/\/\*[\s\S]*?\*\//g, "")
    .replace(/(^|[^:])\/\/.*$/gm, "$1");
}

const clean = stripJsonc(raw);
const obj = JSON.parse(clean);
```

### 小贴士

- 目前仅支持解析；写入时，请去除注释或使用纯 JSON。
- 读取不受信任的输入时应严格对待 —— JSONC 适合配置，不适合传输协议。
- 去除注释时，简单的正则表达式在遇到字符串字面量时可能不安全。建议保持 JSONC 格式，仅在必要时转换。

<!-- custom:end -->
