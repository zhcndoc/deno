---
title: "@std/testing"
description: "用于测试 Deno 代码的工具，如快照测试、BDD 测试和时间模拟"
jsr: jsr:@std/testing
pkg: testing
version: 1.0.17
generated: true
stability: stable
---

<!-- Autogenerated from JSR docs. Do not edit directly. -->

## 概览

<p>该包提供了测试相关的实用工具。</p>
<ul>
<li><a href="https://jsr.io/@std/testing/doc/bdd/~" rel="nofollow">BDD 风格测试</a></li>
<li><a href="https://jsr.io/@std/testing/doc/mock/~" rel="nofollow">测试替身（模拟）</a></li>
<li><a href="https://jsr.io/@std/testing/doc/time/~" rel="nofollow">伪造时间和定时器</a></li>
<li><a href="https://jsr.io/@std/testing/doc/snapshot/~" rel="nofollow">快照测试</a></li>
<li><a href="https://jsr.io/@std/testing/doc/types/~" rel="nofollow">类型断言</a></li>
</ul>

```js
import { assertSpyCalls, spy } from "@std/testing/mock";
import { FakeTime } from "@std/testing/time";

function secondInterval(cb: () => void): number {
  return setInterval(cb, 1000);
}

Deno.test("secondInterval calls callback every second and stops after being cleared", () => {
  using time = new FakeTime();

  const cb = spy();
  const intervalId = secondInterval(cb);
  assertSpyCalls(cb, 0);
  time.tick(500);
  assertSpyCalls(cb, 0);
  time.tick(500);
  assertSpyCalls(cb, 1);
  time.tick(3500);
  assertSpyCalls(cb, 4);

  clearInterval(intervalId);
  time.tick(1000);
  assertSpyCalls(cb, 4);
});
```

### 添加到你的项目

```sh
deno add jsr:@std/testing
```

<a href="https://jsr.io/@std/testing/doc" class="docs-cta jsr-cta">查看 @std/testing 中的所有
符号
<svg class="inline ml-1" viewBox="0 0 13 7" aria-hidden="true" height="20"><path d="M0,2h2v-2h7v1h4v4h-2v2h-7v-1h-4" fill="#083344"></path><g fill="#f7df1e"><path d="M1,3h1v1h1v-3h1v4h-3"></path><path d="M5,1h3v1h-2v1h2v3h-3v-1h2v-1h-2"></path><path d="M9,2h3v2h-1v-1h-1v3h-1"></path></g></svg></a>

<!-- custom:start -->

## 测试

测试是一种验证代码行为符合预期的实践。它帮助及早发现错误，确保代码质量，并在进行修改时提供信心。

查看[Deno 测试示例](/examples/#testing)了解实际用法。

## 为什么使用 @std/testing

结合 Deno 内置的 `Deno.test`，使用这些工具编写更清晰的规范，模拟依赖，伪造定时器，创建快照。

## 示例

```ts
import { afterEach, beforeEach, describe, it } from "@std/testing/bdd";
import { assertSpyCalls, spy } from "@std/testing/mock";
import { FakeTime } from "@std/testing/time";

describe("interval", () => {
  let time: FakeTime;
  beforeEach(() => (time = new FakeTime()));
  afterEach(() => time.restore());

  it("ticks", () => {
    const cb = spy();
    const id = setInterval(cb, 1000);
    time.tick(3000);
    assertSpyCalls(cb, 3);
    clearInterval(id);
  });
});
```

### 快照测试

```ts
import { assertSnapshot } from "@std/testing/snapshot";

Deno.test("user json snapshot", async (t) => {
  const user = { id: 1, name: "Ada", tags: ["admin", "ops"] };
  await assertSnapshot(t, user);
});
```

### Stub 全局方法

```ts
import { stub } from "@std/testing/mock";
import { assertEquals } from "@std/assert";

Deno.test("stub Math.random", () => {
  const s = stub(Math, "random", () => 0.5);
  try {
    assertEquals(Math.random(), 0.5);
  } finally {
    s.restore();
  }
});
```

### 使用 returnsNext 编排序列

```ts
import { returnsNext } from "@std/testing/mock";
import { assertEquals, assertThrows } from "@std/assert";

Deno.test("returnsNext sequences values and errors", () => {
  const next = returnsNext([1, 2, new Error("boom"), 3]);
  assertEquals(next(), 1);
  assertEquals(next(), 2);
  assertThrows(() => next(), Error, "boom");
  assertEquals(next(), 3);
});
```

### 监听并断言调用参数

```ts
import { assertSpyCallArgs, assertSpyCalls, spy } from "@std/testing/mock";

Deno.test("spy captures calls and args", () => {
  const sum = spy((a: number, b: number) => a + b);
  sum(3, 4);
  sum(5, 6);
  assertSpyCalls(sum, 2);
  assertSpyCallArgs(sum, 0, [3, 4]);
});
```

## 小贴士

- 结合 `@std/assert` 或 `@std/expect` 使用断言。
- 使用 `FakeTime` 有确定性地测试定时器和 `Date.now()`。
- 在 `afterEach` 或 `finally` 块中恢复 stub/spy，避免状态泄露。
- 将快照文件提交到版本控制，以捕获意外更改。

<!-- custom:end -->