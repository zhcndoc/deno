---
title: "Deno æ²™ç®±å·æ•™ç¨‹"
description: "ä¸ºä½ çš„ Deno æ²™ç®±æ·»åŠ è¯»å†™å—å­˜å‚¨ã€‚"
url: "/examples/volumes_tutorial/"
---

å·æ˜¯è€ç”¨çš„ã€åŒºåŸŸæ€§çš„å—å­˜å‚¨è®¾å¤‡ï¼Œä½ å¯ä»¥å°†å®ƒä»¬é™„åŠ åˆ° Deno
æ²™ç®±ä¸­ã€‚å®ƒä»¬è¡¨ç°å¾—åƒæ™®é€šç›®å½•ï¼Œå¯ä»¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¼šåœ¨æ²™ç®±ä¼šè¯ä¹‹é—´æŒä¹…ä¿å­˜ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå¯å¤ç°çš„æ•°æ®å‡†å¤‡å·¥ä½œæµï¼šä¸€ä¸ªæ²™ç®±
ä¸‹è½½è®­ç»ƒå·¥ä»¶ä¸€æ¬¡ï¼Œå°†å®ƒä»¬å†™å…¥æŒä¹…å·ï¼Œä»¥åæ¯æ¬¡æ²™ç®±è¿è¡Œéƒ½èƒ½ç«‹å³å¤ç”¨è¯¥ç¼“å­˜ã€‚

æˆ‘ä»¬å°†ï¼š

1. åˆ›å»ºä¸€ä¸ªåä¸º `training-cache` çš„åŒºåŸŸå·ã€‚
2. å¯åŠ¨ä¸€ä¸ªâ€œprepareâ€æ²™ç®±ï¼Œå°†æ–‡ä»¶å†™å…¥è¯¥å·çš„ `/data/cache` ç›®å½•ä¸­ã€‚
3. å‡ å°æ—¶åå¯åŠ¨ä¸€ä¸ªâ€œserveâ€æ²™ç®±ï¼Œè¯»å–ç›¸åŒçš„æ–‡ä»¶ä»¥æ¨¡æ‹Ÿè®­ç»ƒä½œä¸šã€‚
4. æ£€æŸ¥ä½¿ç”¨æƒ…å†µå¹¶åœ¨å®Œæˆåæ‹†é™¤å…¨éƒ¨èµ„æºã€‚

## èº«ä»½éªŒè¯å¹¶å¯åŠ¨å®¢æˆ·ç«¯

ä¸ºäº†ä½¿ç”¨ Deno æ²™ç®± APIï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è®¾ç½® Deno æ²™ç®±è®¿é—®ä»¤ç‰Œã€‚

1. åœ¨ Deno Deploy æ§åˆ¶å°ï¼Œå¯¼èˆªåˆ° **æ²™ç®±ï¼ˆSandboxesï¼‰** éƒ¨åˆ†ã€‚
2. åˆ›å»ºæ–°ä»¤ç‰Œï¼Œå¹¶å¤åˆ¶ä»¤ç‰Œå€¼ã€‚
3. å°†æ­¤ä»¤ç‰Œè®¾ç½®ä¸ºæœ¬åœ°ç¯å¢ƒå˜é‡ `DENO_DEPLOY_TOKEN`ã€‚

ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SDK å¯åŠ¨å®¢æˆ·ç«¯ï¼š

```tsx
import { Client } from "@deno/sandbox";

const client = new Client();
```

## ä¸ºç¼“å­˜é…ç½®å­˜å‚¨

é€‰æ‹©ä¸€ä¸ªä¸è®¡åˆ’è¿è¡Œæ²™ç®±åŒ¹é…çš„åŒºåŸŸï¼ˆ`ord` æˆ– `ams`ï¼‰ã€‚

æˆ‘ä»¬å°†ä¸ºè®­ç»ƒç¼“å­˜å·æä¾› 2GB çš„å­˜å‚¨ç©ºé—´ï¼š

```tsx
const volume = await client.volumes.create({
  slug: "training-cache",
  region: "ord",
  capacity: "2GB",
});

console.log(`å·²åˆ›å»ºå· ${volume.slug} ï¼ˆå®¹é‡ ${volume.capacity} å­—èŠ‚ï¼‰`);
```

å·çš„ slug å¿…é¡»åœ¨ç»„ç»‡å†…å”¯ä¸€ï¼›å“åº”è¿”å› slug å’Œç¨³å®šçš„ UUIDã€‚å®¹é‡å­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»»ä½•ä»‹äº 300MB åˆ° 20GB ä¹‹é—´çš„åè¿›åˆ¶å•ä½ï¼ˆGB/MB/KBï¼‰æˆ–äºŒè¿›åˆ¶å•ä½ï¼ˆGiB/MiB/KiBï¼‰ã€‚

## ä»…å¡«å……ç¼“å­˜ä¸€æ¬¡

å‡è®¾ä½ çš„è®­ç»ƒä½œä¸šéœ€è¦ä¸‹è½½å¤§å‹æ•°æ®é›†æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

ä¸æ˜¯æ¯æ¬¡è¿è¡Œéƒ½æ‹‰å–ï¼Œ`prepare` æ²™ç®±ä¼šå°†å®ƒå†™å…¥å…±äº«å·ä¸­ã€‚

æˆ‘ä»¬å°†åœ¨æ²™ç®±å†…å°†å·æŒ‚è½½åˆ°è·¯å¾„ `/data/cache`ï¼š

```tsx title="main.ts"
import { Client, Sandbox } from "@deno/sandbox";

const client = new Client();

const volume = await client.volumes.create({
  slug: "training-cache",
  region: "ord",
  capacity: "2GB",
});

console.log(`å·²åˆ›å»ºå· ${volume.slug} ï¼ˆå®¹é‡ ${volume.capacity} å­—èŠ‚ï¼‰`);

await using sandbox = await Sandbox.create({
  region: "ord",
  volumes: {
    "/data/cache": volume.slug,
  },
  labels: { job: "prepare" },
});

await sandbox.fs.mkdir("/data/cache/datasets", { recursive: true });
await sandbox.fs.writeTextFile(
  "/data/cache/datasets/embeddings.json",
  JSON.stringify({ updatedAt: Date.now(), vectors: [1, 2, 3] }, null, 2),
);

await sandbox.fs.writeTextFile(
  "/data/cache/README.txt",
  "ç¼“å­˜ä¸€æ¬¡ï¼Œæ°¸ä¹…å¤ç”¨ã€‚\n",
);
```

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ²™ç®±ï¼Œåœ¨å…¶ä¸­æŒ‚è½½äº†å·åˆ° `/data/cache` ç›®å½•ã€‚ç„¶åå†™å…¥äº†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®é›†æ–‡ä»¶ã€‚

ä½¿ç”¨å‘½ä»¤ `deno run -A main.ts` è¿è¡Œæ­¤è„šæœ¬ä»¥åˆ›å»ºå·å¹¶å¡«å……æ•°æ®ã€‚

## ç¨åå¤ç”¨ç¼“å­˜

æ•°å°æ—¶ï¼ˆæˆ–éƒ¨ç½²ï¼‰åï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çš„æ²™ç®±ï¼ŒæŒ‰ slug æŒ‚è½½ç›¸åŒå·ï¼Œå¹¶è¯»å–æ–‡ä»¶ã€‚è¿™æ¨¡æ‹Ÿäº†ä¸€ä¸ªè·³è¿‡è€—æ—¶ä¸‹è½½æ­¥éª¤çš„å¯å¤ç°è®­ç»ƒè¿è¡Œã€‚

```tsx title="main2.ts"
import { Sandbox } from "@deno/sandbox";

await using sandbox = await Sandbox.create({
  region: "ord",
  volumes: {
    "/data/cache": "training-cache",
  },
});

const metadata = await sandbox.fs.readTextFile(
  "/data/cache/datasets/embeddings.json",
);

console.log("åŠ è½½çš„ç¼“å­˜æ•°æ®é›†ï¼š", metadata);
```

ä½¿ç”¨å‘½ä»¤ `deno run -A main2.ts` è¿è¡Œæ­¤è„šæœ¬ï¼Œå¯åŠ¨æ–°æ²™ç®±å¹¶è¯»å–ç¼“å­˜æ–‡ä»¶ã€‚

å› ä¸ºå·è¡¨ç°å¾—åƒæ™®é€šç›®å½•ï¼Œä½ å¯ä»¥åœ¨æŒ‚è½½ç‚¹ç›´æ¥æµå¼ä¼ è¾“æ—¥å¿—ï¼Œè¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æˆ–å­˜å‚¨ SQLite æ•°æ®åº“ã€‚

## ç¼“å­˜å¢é•¿æ—¶æ£€æŸ¥ä½¿ç”¨æƒ…å†µ

ä½ å¯ä»¥åˆ—å‡ºç»„ç»‡ä¸­çš„å·å¹¶æŸ¥çœ‹å…¶å½“å‰ä½¿ç”¨æƒ…å†µï¼Œè¿™åœ¨è§„åˆ’å°†æ¥å·¥ä½œè´Ÿè½½å®¹é‡æ—¶éå¸¸æœ‰å¸®åŠ©ã€‚

```tsx
const page = await client.volumes.list({ search: "training" });
for (const vol of page.items) {
  console.log(
    `${vol.slug} ä½¿ç”¨äº† ${vol.estimatedFlattenedSize}/${vol.capacity} å­—èŠ‚`,
  );
}

const latest = await client.volumes.get(volume.slug);
console.log(
  `æœ€è¿‘çš„ä½¿ç”¨ä¼°è®¡ï¼š${latest?.estimatedFlattenedSize} å­—èŠ‚`,
);
```

é¥æµ‹æ•°æ®å¯èƒ½ä¼šæ¯”å®é™…ä½¿ç”¨æƒ…å†µæ»åå‡ åˆ†é’Ÿï¼Œå› æ­¤é€‰æ‹© `capacity` æ—¶åº”ç•™æœ‰ä½™é‡ã€‚

## å®éªŒç»“æŸæ—¶æ¸…ç†

å®Œæˆä½¿ç”¨åï¼Œå¯ä»¥åˆ é™¤å·ä»¥é‡Šæ”¾èµ„æºï¼š

```tsx
await client.volumes.delete(volume.slug);
```

åˆ é™¤æµç¨‹æ—¢æ˜¯æœ‰æ„ä¸ºä¹‹ï¼Œä¹Ÿæœ‰ä¿æŠ¤æªæ–½ï¼š

1. å·ä¼šç«‹å³æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œå¹¶ä»æœªæ¥çš„æ²™ç®±è¯·æ±‚ä¸­åˆ†ç¦»â€”â€”å…¶ slug ä¼šé‡æ–°å¯ç”¨ã€‚
2. åº•å±‚å—å­˜å‚¨ä¼šåœ¨ 24 å°æ—¶å®½é™æœŸåé”€æ¯ï¼Œå¦‚è¯¯åˆ å¯è”ç³»æ”¯æŒã€‚

ğŸ¦• ä½ ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªè·¨æ²™ç®±è¿è¡Œç¼“å­˜å·¥ä»¶çš„å®æˆ˜æ¨¡å¼ã€‚æ›¿æ¢æˆä½ è‡ªå·±çš„æ•°æ®é›†ã€äºŒè¿›åˆ¶æ–‡ä»¶æˆ–æ„å»ºäº§ç‰©ï¼ŒåŠ é€Ÿä»»ä½•éœ€è¦æŒä¹…å­˜å‚¨ä¸”ä¸ç¦»å¼€æ²™ç®±ç¯å¢ƒçš„ä½œä¸šã€‚