---
title: 可观测性
---

:::info

您正在查看 Deno Deploy<sup>EA</sup> 的文档。想要查找 Deploy Classic 文档？[点击这里查看](/deploy/)。

:::

Deno Deploy<sup>EA</sup> 提供了多种可观测性功能，用于了解应用性能、调试应用错误以及监控应用使用情况。这些功能基于 OpenTelemetry 以及 Deno 中的 [OpenTelemetry 集成](/runtime/fundamentals/open_telemetry/)。

Deno Deploy<sup>EA</sup> 中有三种主要的可观测性功能：

- **日志**：应用代码发出的非结构化调试信息。
- **追踪**：有关请求处理的结构化信息，包括每个步骤所花的时间，以及通过 `fetch` 等方式自动捕获的出站 I/O。
- **指标**：有关应用性能和使用情况的结构化高级数据，例如请求数量、错误数量和延迟。

## 日志

Deno Deploy<sup>EA</sup> 中的日志使用标准的 `console` API 捕获。日志可以在 Deno Deploy<sup>EA</sup> 仪表板的日志页面中查询。

日志按应用查看。日志页面上的搜索栏可用于基于以下属性和日志消息进行筛选。

如果日志是在追踪上下文中发出的，则日志会关联到特定的追踪和跨度。对于有关联追踪的日志，日志页面会显示“查看追踪”按钮，点击可在覆盖抽屉中打开相关追踪以进行检查。

## 追踪

Deno Deploy<sup>EA</sup> 中的追踪通过三种方式捕获：

- 对各种内置操作自动捕获，如传入 HTTP 请求或出站 fetch。此功能无法禁用。
- 对某些框架（如 Next.js、Fresh 和 Astro）自动捕获。具体支持的框架和操作可能会变更。
- 当应用代码使用 OpenTelemetry API 手动创建新的追踪或跨度时手动捕获。这需要对应用代码进行手动埋点。

追踪按应用查看。追踪页面上的搜索栏可用于基于以下属性和跨度名称进行筛选。

点击某个追踪会打开追踪覆盖抽屉，显示该追踪中的所有跨度。跨度以瀑布流视图展示，显示每个跨度的开始和结束时间，以及持续时间。跨度按父跨度分组，根跨度显示在瀑布流视图顶部。

点击任意跨度会在抽屉底部打开跨度详情。这里以表格形式显示捕获的跨度属性。例如，对于出站 HTTP 请求，会显示 HTTP 方法、URL 和状态码。

除了跨度属性，跨度详情部分还有一个“日志”标签页，展示在该跨度上下文中发出的所有日志。

点击任一追踪右侧的“查看日志”会打开日志页面，搜索栏预填追踪 ID，显示该追踪上下文中发出的所有日志。

## 指标

Deno Deploy<sup>EA</sup> 中的指标自动捕获各种内置操作的数据，如传入 HTTP 请求或出站 fetch。此功能无法禁用。

指标按应用查看。指标页面的搜索栏可用于基于以下属性进行筛选。指标以时间序列图展示，显示指标随时间的变化值。

## 筛选

日志、追踪和指标可按通用属性筛选：

- **版本**：发出日志、追踪或指标的应用版本 ID。

- **上下文**：发出日志、追踪或指标的环境上下文，可为“生产”或“开发”。

对于日志和追踪，还可使用以下附加筛选条件：

- **追踪**：包含日志或跨度的追踪 ID。

仅对追踪可用的额外筛选条件：

- **HTTP 方法**：触发追踪的请求的 HTTP 方法。

- **HTTP 路径**：触发追踪的请求路径。

- **HTTP 状态**：针对触发追踪请求发送的响应的 HTTP 状态码。

### 时间范围筛选

默认情况下，日志、追踪和指标页面显示最近一小时的数据。可通过页面右上角的时间范围筛选器进行更改。时间范围筛选器支持预设时间段，如“最近 1 小时”、“最近 24 小时”或“最近 7 天”，也支持自定义时间范围。

点击“自定义”按钮可设置自定义时间范围。自定义时间范围可以是绝对的（具体的开始和结束时间）或相对的（3 天前，1 小时后等）。时间范围筛选器显示在页面右上角。

相对时间范围采用与 Grafana 相同的语法，其中 `now` 表示当前时间，`now-1h` 表示一小时前。此外，语法如 `now-1h/h` 可用于向最接近的小时取整。示例：

- `now-1h` — 一小时前
- `now/h` — 当前小时的开始时间
- `now-1h/h` — 上一小时的开始时间
- `now/d+3h` — 当天开始时间后的 3 小时
- `now-1d/d` — 前一天的开始时间